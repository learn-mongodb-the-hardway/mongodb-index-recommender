dist: trusty
sudo: true
language: java
jdk:
- oraclejdk8

#addons:
#  apt:
#    sources:
#    - mysql-5.7-trusty
#    packages:
#    - mysql-server
#    - mysql-client
#services:
#- mongodb

notifications:
  email:
    recipients:
    - christkv@gmail.com
    on_success: change
    on_failure: always

branches:
  only:
  - master

install:
- ./gradlew --version

before_script:
  - wget http://fastdl.mongodb.org/linux/mongodb-linux-x86_64-${MONGODB_VERSION}.tgz -O /tmp/mongodb.tgz
  - tar -xvf /tmp/mongodb.tgz
  - mkdir /tmp/data
  - ${PWD}/mongodb-linux-x86_64-${MONGODB_VERSION}/bin/mongod --setParameter enableTestCommands=1 --dbpath /tmp/data --bind_ip 127.0.0.1 --auth &> /dev/null &
  - export MONGODB_VERSION=${MONGODB_VERSION}

env:
  global:
    - CI="travis"
  matrix:
    - MONGODB_VERSION=4.0.1

#before_install:
#- sudo mysql -e "use mysql; update user set authentication_string=PASSWORD('root') where User='root'; update user set plugin='mysql_native_password';FLUSH PRIVILEGES;"
#- sudo mysql_upgrade -u root --password=root
#- sudo service mysql restart

script:
- ./gradlew test -i -PTRAVIS=true

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/